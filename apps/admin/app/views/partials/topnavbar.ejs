<header class="topbar glass-panel">
    <div class="topbar__cluster">
        <button class="icon-btn" type="button" data-toggle-sidebar aria-label="Toggle navigation">
            <i data-feather="menu"></i>
        </button>
        <div class="topbar__titles">
            <p class="eyebrow-text">Admin control</p>
            <div class="d-flex align-items-center gap-50 flex-wrap">
                <h1 class="topbar__headline"><%= project_name %> panel</h1>
                <span class="pill pill--accent">Live workspace</span>
            </div>
        </div>
    </div>

    <div class="topbar__actions">
        <div class="topbar__search" role="search">
            <i class="fa fa-search"></i>
            <input type="search" class="form-control" placeholder="Search modules, commands, or data" aria-label="Search admin content">
        </div>

        <%
            const safeFullName = (user.full_name || '').trim();
            const safeFirstName = (user.first_name || '').trim();
            const safeLastName = (user.last_name || '').trim();
            const displayName = safeFullName || `${safeFirstName} ${safeLastName}`.trim();
            const roleDisplayName = (user.role && user.role.roleDisplayName) ? user.role.roleDisplayName : '';
            const initials = (() => {
                if (safeFirstName || safeLastName) {
                    return `${safeFirstName.charAt(0)}${safeLastName.charAt(0)}`.toUpperCase();
                }

                if (safeFullName) {
                    return safeFullName
                        .split(' ')
                        .filter(Boolean)
                        .map(name => name.charAt(0))
                        .join('')
                        .slice(0, 2)
                        .toUpperCase();
                }

                return '';
            })();
        %>

        <div class="topbar__quick">
            <a class="ghost-btn" href="<%= generateUrl('admin.notification.compose') %>">
                <i data-feather="bell"></i>
                Notify users
            </a>
            <a class="ghost-btn" href="<%= generateUrl('admin.deal.listing') %>">
                <i data-feather="layout"></i>
                View deals
            </a>
        </div>

        <div class="dropdown dropdown-user topbar__avatar-group">
            <a class="d-flex align-items-center text-decoration-none" id="dropdown-user" href="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="avatar-label d-none d-sm-flex flex-column text-start me-50">
                    <span class="text-white fw-bold"><%= displayName || 'User' %></span>
                    <small class="text-muted"><%= roleDisplayName || 'Administrator' %></small>
                </div>
                <span class="avatar avatar-light-primary">
                    <% if (!user.profile_image) { %>
                    <div class="avatar-content"><%= initials || 'U' %></div>
                    <% } else { %>
                        <img class="round" src="/uploads/user/profile_pic/<%= user.profile_image %>" alt="avatar" height="40" width="40">
                    <% } %>
                </span>
            </a>
            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-user">
                <a class="dropdown-item" href="<%= generateUrl('admin.profile', {id: user._id})%>">
                    <i class="me-50" data-feather="settings"></i>
                    Settings
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="<%= generateUrl('user.logout')%>">
                    <i class="me-50" data-feather="power"></i>
                    Logout
                </a>
            </div>
        </div>
    </div>
</header>